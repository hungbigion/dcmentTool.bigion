<!doctype html>
<meta charset="utf-8">
<title>HỢP ĐỒNG FULL</title>
<meta name="csrf-token" content="MHMXdIG4tBlzbq7sMs8y0wjq43Dtbf8PaMgnKDS3">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>

<!-- Popper JS -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />


<style>
    * {
        font-family: "Times New Roman", Times, serif;
    }
    .item {
    margin-right: 40px;
    }
    .item:last-child {
    margin-right: 0;
    }
    body {
        background: rgb(204, 204, 204);
    }
    #backtotop{
        position: fixed;
        z-index: 1000;
    }

    page {
        background: white;
        display: block;
        margin: 0 auto;
        margin-bottom: 0.5cm;
        box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        align-items: center;
    }

    page[size="A5"][layout="portrait"] {
        width: 14.8cm;
    }


   
    @media print {
        body,
        #content {
            margin: 0;
            box-shadow: 0;
            font-size: 18px !important;
        }

        .big-title {
            font-size: 18px !important;
        }

        .total-pay {
            font-size: 15px !important;
        }

        @page {
            size: auto;
        }
        
        #content-split {
            margin-top: 40px;
            position: absolute;
            top: 50%;
            width: 100%;
        }

        .height_hr {
            border-top: 3px dashed black;
            width: 100%;
            position: absolute;
            top: 49%;
        }

        #content-split .div-logo {
            position: relative;
            top: -10px;
            left: 10px;
        }
    }

    #content {
        font-size: 10.5px;
    }


    .center {
        text-align: center;
    }

    .right {
        text-align: right;
    }

    .bold {
        font-weight: bold;
    }

    .big-title {
        font-size: 15px;
    }

    #fixed-panel,
    #fixed-show-user,
    #fixed-show-reason {
        font-size: 13px;
    }


    #content {
        padding-left: 20px;
        padding-right: 20px;
        max-width: 19.5cm;
        height: max-content;
    }

    #select-setup-print {
        position: relative;
        top: -2px;
        background-color: #17a2b8;
        color: white;
    }

    #setup-print {
        position: fixed;
        top: 480px;
        left: 30px;
        width: 150px;
        height: 54px;
        background-color: #ffffff;
        padding: 10px;
        border-radius: 5px;
        /*font-size: 13px;*/
        box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
    }


    .heigth-90px {
        height: 90px !important;
    }

    #page {
        margin-top: 20px;
        margin-bottom: 20px;
        position: relative;
        border: 1px solid black; 
    }


    .big-title {
        text-transform: uppercase;
        font-weight: bold;
        /*font-size: 15px;*/
        padding-bottom: 5px;
    }

    hr {
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .bold {
        font-weight: bold;
    }

    .info_student {
        margin-top: 10px;
        text-align: justify;
    }

    .info_contract {
        margin-bottom: 5px !important
    }
    .fixed-button {
            position: fixed;
            bottom: 20px; /* Điều chỉnh vị trí từ dưới lên, bạn có thể thay đổi giá trị này */
            right: 20px;  /* Điều chỉnh vị trí từ phải sang, bạn có thể thay đổi giá trị này */
            width: 100%;
            max-width: 200px; /* Điều chỉnh chiều rộng tối đa của button */
        }

    @media only screen and (max-width: 1024px) {
        #fixed-panel {
            display: none !important;
        }
        #list_option_print {
            display: none !important;
        }
    }
</style>

<body>
    <button onclick="print()" id="backtotop" class="btn btn-info fixed-button" style="width: 100%"><i class="fa fa-print"></i> <span
        class="language_print"></span></button>
    <page size="A5" id="page" layout="portrait">
        <div id="content">
            <div style="border: none; padding: 10px; display: flex; align-items: center;justify-content: space-between;">
                <div>
                    <img src="https://www.appsheet.com:443/fsimage.png?appid=237238ed-4230-4db1-ab50-e492cea9cdba&datasource=google&filename=DocId%3D1egTRwdbY1nciPNbp0oyfwtw2nkjAaPEk&signature=2a1e24bf7c4923ebddf506465345589f92fe6343600fded5f6a451ffc64d134b&tableprovider=google&userid=925719472" 
                    alt="LEA Logo" style="width: 80px;">
                </div>
                <div style="text-align: center;font-weight: bolder;margin-right: 70px;margin-left: 20px;">
                    <h7 style="margin: 0;">TRUNG TÂM NGOẠI NGỮ LIÊN ÂU MỸ</h7>
                    <p style="margin: 0;">
                        ĐT: TPK - 02743618998 - TU: 02743639995 - HN: 02746549595 <br>
                        Websites: www.lea.edu.vn - Hotline: 0274.9999.899
                    </p>
                </div>
                <div></div>
            </div>
            <h6 style="text-align: center;font-weight: bolder;">PHIẾU THU</h6>
        
            <div style="display: flex; justify-content: flex-end; ">
                <div style="text-align: right;">
                    <span style="font-style: oblique;">Số chứng từ:&ensp;</span>
                    <span id="sct"></span>
                </div>
            </div>
            <p><span id="nct">27/09/2024</span></p>
            <div style="justify-content: start;display: flex;">
                <p class="item"><span style="font-weight: bolder;">Tên học viên:&ensp;</span> <span id="ten"></span></p>
                <p class="item"><strong>Số điện thoại:&ensp;</strong><span id="sdt"></span></p>
            </div>
        
            <div>
                <p><strong>Lớp:&ensp;</strong><span id="lop"></span></p>
                <div style="justify-content: start;display: flex;">                
                    <p class="item"><strong>Ngày khai giảng:&ensp;</strong> <span id="nkg"></span></p>
                    <p class="item"><strong>Ngày kết thúc:&ensp;</strong> <span id="nkt"></span></p>
                </div>
                <p><strong>Ngày vào học:&ensp;</strong> <span id="nvh"></span></p>
            </div>
        
            <div>
                <p><strong>Ghi chú:&ensp;</strong> <span id="note"></span></p>
            </div>
        
            <div>
                <div style="justify-content: start;display: flex;">
                    <p class="item"><strong>Khóa học:&ensp;</strong> <span id="khoahoc"></span></p>
                    <p class="item"><strong>Học phí:&ensp;</strong> <span id="hphi"></span> ₫</p>
                </div>
                <!-- inline element -->
                <div style="display: inline;">
                    <p><strong>Giáo trình:&ensp;</strong><span id="tengt"></span></p>
                    <p><strong>Tiền giáo trình:&ensp;</strong><span id="tiengt"></span> ₫</p>
                </div>
            </div>
        <!-- inline element -->
            <div style="display: inline;">
                <p><strong>Ưu đãi: </strong>&ensp;<span id="pcdc"></span>&emsp;&emsp;&emsp;&ensp;<strong>Thành tiền ưu đãi: </strong>&ensp;<span id="prdc"></span> ₫</p>
                <p><strong>Ưu đãi khác: </strong>&ensp;<span id="pcdc"></span>&emsp;<strong>Thành tiền ưu đãi khác: </strong>&ensp;<span id="prdc"></span> ₫</p>
            </div>
        
            <div>
                <div style="justify-content: start;display: flex;">
                    <p class="item"><strong>Thành tiền:&ensp;</strong><span id="ttien"></span> ₫</p>
                    <p class="item"><strong>Số tiền thanh toán:&ensp;</strong><span id="ttt"></span> ₫</p>
                </div>
                <p><strong>Còn lại:&ensp;</strong><span id="conlai"></span></p>
            </div>
            <div>
                <p><strong>Tổng tiền bằng chữ:&ensp;</strong><span id="ttientext"></span></p>
                <p><strong>Số tiền thanh toán bằng chữ:&ensp;</strong><span id="ttttext"></span></p>
                <p><strong>Còn lại bằng chữ:&ensp;</strong><span id="conlaitext"></span></p>
            </div>
        
            <div >
                <div style="text-align: center; display: flex; justify-content: space-between;padding-left: 20px;padding-right: 20px;">
                    <div><strong>Người lập phiếu </strong><br> (Ký ghi rõ họ tên)</div>
                    <div><strong>Người nộp tiền</strong> <br> (Ký ghi rõ họ tên)</div>
                    <div><strong>Thủ trưởng đơn vị</strong> <br> (Ký ghi rõ họ tên)</div>
                </div>
            </div>
            <div style="margin-top: 140px;font-size: 11px;">
                <p><strong>Lưu ý:</strong> Trung tâm sẽ không hoàn lại học phí trong bất kỳ trường hợp <br>
                    nào Đối với các trường hợp đặc biệt, học phí sẽ được bảo lưu trong thời gian 1 khóa</p>
            </div>
        </div>
    </page>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
        integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.centeronline.edu.vn/js/customer.js" type="text/javascript"></script>

    <script>
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(window.location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        // truyền id vào đây
        var parameters = ['sct','nct','ten','sdt','lop','khoahoc','nkg','nkt','nvh','note','hphi','tengt','tiengt','pcdc','prdc','ttien','ttt','conlai'];
        parameters.forEach(function (param) {
            var value = getUrlParameter(param);
            setTextContentById(param, value);
        });
        document.addEventListener('keydown', function(event) {
             if (event.code === 'Space') {
                 event.preventDefault(); 
                 print(); 
             }
         });
         $('#printButton').on('click', function() {
             print(); 
         });
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        // Function to set text content if element exists
        function setTextContentById(id, value) {
            var element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }
        // num to text
        // Hàm chuyển số thành chữ số tiền
function numberToWords(num) {
    const units = ['không', 'một', 'hai', 'ba', 'bốn', 'năm', 'sáu', 'bảy', 'tám', 'chín'];
    const teens = ['mười', 'mười một', 'mười hai', 'mười ba', 'mười bốn', 'mười lăm', 'mười sáu', 'mười bảy', 'mười tám', 'mười chín'];
    const tens = ['', '', 'hai mươi', 'ba mươi', 'bốn mươi', 'năm mươi', 'sáu mươi', 'bảy mươi', 'tám mươi', 'chín mươi'];
    const thousands = ['', 'nghìn', 'triệu', 'tỷ'];

    if (num === 0) return 'không đồng';

    const convertChunk = (n) => {
        let str = '';
        
        if (n >= 100) {
            str += units[Math.floor(n / 100)] + ' trăm ';
            n %= 100;
        }

        if (n >= 20) {
            str += tens[Math.floor(n / 10)] + ' ';
            n %= 10;
        } else if (n >= 10) {
            str += teens[n - 10] + ' ';
            n = 0;
        }

        if (n > 0) {
            str += units[n] + ' ';
        }

        return str.trim();
    };

    let result = '';
    let unitIndex = 0;

    while (num > 0) {
        const chunk = num % 1000;
        if (chunk > 0) {
            result = convertChunk(chunk) + ' ' + thousands[unitIndex] + ' ' + result;
        }
        num = Math.floor(num / 1000);
        unitIndex++;
    }

    return result.trim() + ' đồng';
}

// Hàm để lấy giá trị từ URL, chuyển đổi thành chữ và set cho element
function setValuesFromParameters() {
    // Danh sách các parameter và ID của element HTML
    const paramNames = ['ttien', 'ttt', 'conlai'];
    const elementIds = ['ttientext', 'ttttext', 'conlaitext'];

    paramNames.forEach((paramName, index) => {
        // Lấy giá trị từ parameter
        let paramValue = getUrlParameter(paramName);

        if (paramValue) {
            // Chuyển đổi giá trị thành số và loại bỏ các ký tự không phải số
            let numberValue = parseInt(paramValue.replace(/\./g, '').replace(/₫/, '').trim(), 10);

            if (!isNaN(numberValue)) {
                // Chuyển số thành chữ số tiền
                let textValue = numberToWords(numberValue);

                // Set giá trị vào element HTML tương ứng
                let textElement = document.getElementById(elementIds[index]);
                if (textElement) {
                    textElement.innerText = textValue;
                }
            }
        }
    });
}

// Gọi hàm để xử lý và set các giá trị
setValuesFromParameters();
// Hàm định dạng số thành chuỗi có dấu chấm phân cách hàng nghìn
function formatNumberWithDots(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

// Hàm để lấy giá trị từ URL, định dạng và set cho element
function setFormattedNumbersFromParameters() {
    // Danh sách các parameter và ID của element HTML
    const paramNames = ['hphi','tiengt','prdc','ttien','ttt','conlai'];
    const elementIds = ['hphi','tiengt','prdc','ttien','ttt','conlai'];

    paramNames.forEach((paramName, index) => {
        // Lấy giá trị từ parameter
        let paramValue = getUrlParameter(paramName);

        if (paramValue) {
            // Chuyển giá trị thành số và loại bỏ các ký tự không phải số
            let numberValue = parseInt(paramValue.replace(/\./g, '').replace(/₫/, '').trim(), 10);

            if (!isNaN(numberValue)) {
                // Định dạng số thành chuỗi có dấu chấm phân cách hàng nghìn
                let formattedValue = formatNumberWithDots(numberValue);

                // Set giá trị đã định dạng vào element HTML tương ứng
                let textElement = document.getElementById(elementIds[index]);
                if (textElement) {
                    textElement.innerText = formattedValue;
                }
            }
        }
    });
}

// Gọi hàm để xử lý và set các giá trị
setFormattedNumbersFromParameters();
// xử lý date
    // Hàm chuyển đổi định dạng ngày từ mm/dd/yyyy sang dd/mm/yyyy
    function convertDateFormat(dateStr) {
        // Tách chuỗi ngày bằng dấu "/"
        const parts = dateStr.split('/');
        if (parts.length === 3) {
            const month = parts[0];
            const day = parts[1];
            const year = parts[2];
            // Trả về chuỗi theo định dạng dd/mm/yyyy
            return `${day}/${month}/${year}`;
        }
        return dateStr; // Trả về nguyên chuỗi nếu không đúng định dạng
    }

    // Hàm để lấy giá trị ngày từ URL, chuyển đổi và set cho element
    function setFormattedDatesFromParameters() {
        // Danh sách các parameter và ID của element HTML
        const paramNames = ['nkg','nkt','nvh'];
        const elementIds = ['nkg','nkt','nvh'];

        paramNames.forEach((paramName, index) => {
            // Lấy giá trị từ parameter
            let paramValue = getUrlParameter(paramName);

            if (paramValue) {
                // Chuyển đổi định dạng ngày từ mm/dd/yyyy sang dd/mm/yyyy
                let formattedDate = convertDateFormat(paramValue);

                // Set giá trị ngày đã chuyển đổi vào element HTML tương ứng
                let dateElement = document.getElementById(elementIds[index]);
                if (dateElement) {
                    dateElement.innerText = formattedDate;
                }
            }
        });
    }

    // Gọi hàm để xử lý và set các giá trị
    setFormattedDatesFromParameters();
    // Hàm chuyển đổi định dạng mm/dd/yyyy sang "Ngày dd, Tháng mm Năm yyyy"
function convertDateToText(dateStr) {
    const monthNames = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
    
    // Tách chuỗi ngày bằng dấu "/"
    const parts = dateStr.split('/');
    if (parts.length === 3) {
        const month = monthNames[parseInt(parts[0], 10) - 1]; // Lấy tháng từ 0-11
        const day = parseInt(parts[1], 10); // Lấy ngày
        const year = parts[2]; // Lấy năm
        // Trả về chuỗi theo định dạng "Ngày dd, Tháng mm Năm yyyy"
        return `Ngày ${day}, Tháng ${month} Năm ${year}`;
    }
    return dateStr; // Trả về nguyên chuỗi nếu không đúng định dạng
}

// Hàm để lấy giá trị ngày từ URL, chuyển đổi và set vào element
function setFormattedDateTextFromParameters() {
    // Danh sách các parameter và ID của element HTML
    const paramNames = ['nct'];
    const elementIds = ['nct'];

    paramNames.forEach((paramName, index) => {
        // Lấy giá trị từ parameter
        let paramValue = getUrlParameter(paramName);

        if (paramValue) {
            // Chuyển đổi ngày thành đoạn text
            let formattedDateText = convertDateToText(paramValue);

            // Set giá trị đã chuyển đổi vào element HTML tương ứng
            let dateElement = document.getElementById(elementIds[index]);
            if (dateElement) {
                dateElement.innerText = formattedDateText;
            }
        }
    });
}

// Gọi hàm để xử lý và set các giá trị
setFormattedDateTextFromParameters();
        function print() {
            $('#content').printThis({
                debug: false, // show the iframe for debugging
                importCSS: true, // import parent page css
                importStyle: true, // import style tags
                printContainer: true, // print outer container/$.selector
                // loadCSS: ["assets/vendors/base/vendors.bundle.css", ""], // path to additional css file - use an array [] for multiple
                pageTitle: "", // add title to print page
                removeInline: false, // remove inline styles from print elements
                removeInlineSelector: "*", // custom selectors to filter inline styles. removeInline must be true
                printDelay: 333, // variable print delay
                header: null, // prefix to html
                footer: null, // postfix to html
                base: false, // preserve the BASE tag or accept a string for the URL
                formValues: true, // preserve input/form values
                canvas: false, // copy canvas content
                removeScripts: false, // remove script tags from print content
                copyTagClasses: false, // copy classes from the html & body tag
                beforePrintEvent: null, // function for printEvent in iframe
                beforePrint: null, // function called before iframe is filled
                afterPrint: null // function called before iframe is removed
            });
        }
        // Gọi hàm để cập nhật giá trị khi trang được tải
    </script>
</body>
